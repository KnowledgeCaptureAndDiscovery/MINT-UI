<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="mint-common-styles.html">

<link rel="import" href="../bower_components/mint-map/mint-map.html">
<link rel="import" href="mint-ajax.html">
<link rel="import" href="variable-graph.html">

<dom-module id="mint-results-detail">

  <template>

    <style include="mint-common-styles">

      :host {
        display: block;
      }

      .smooth {
        transition: opacity 0.4s;
        opacity: 0;
      }

      .smooth[has-content] {
        opacity: 1;
      }

      .detail {
        width: 90%;
        max-width: 1440px;
        margin:0 auto;
        margin-bottom: 5px;
        height: 800px;
      }

      .left {
        width: 40%;
      }
      .right {
        width: 60%;
      }
      .map {
        border: 2px solid var(--app-primary-color);
        border-radius: 4px;
        margin: 5px 0px;
      }

      .content {
        @apply(--layout-horizontal);
      }

      mint-map {
        width: 100%;
        height: 100%;
      }

      .outer {
        width:100%;
        height: 700px;
        overflow: auto;
        border: 2px solid var(--app-accent-color);
        border-width:0px 2px;
      }
      .toolbar {
        color:white;
        width:100%;
        background-color: var(--app-accent-color);
        border: 2px solid var(--app-accent-color);
        border-radius: 0px 4px 0px 0px;
        @apply --layout-horizontal;
        @apply --layout-no-wrap;
        @apply --layout-center-justified;
      }
      .toolbar paper-button, .toolbar paper-icon-button {
        max-height: 36px;
        color: white;
      }
      .bottom {
        border-radius: 0px 0px 4px 0px;
      }
      .toolbar paper-button {
        min-width:32px;
      }

      @media (max-width: 767px) {
        .left, .right {
          width: 100%;
        }
        .content {
          @apply(--layout-vertical);
          @apply(--layout-center);
        }

        .detail {
          box-sizing: border-box;
          margin: 8px 0;
          padding: 0 24px;
          width: 100%;
          /*max-width: 600px;*/
        }

        .toolbar {
          border-radius: 4px 4px 0px 0px;
        }
        .bottom {
          border-radius: 0px 0px 4px 4px;
        }
        .outer {
          height: 450px;
        }
      }
    </style>

    <app-route
        route="[[route]]"
        pattern="/:category/:item"
        data="{{routeData}}"></app-route>

      <!-- Variable Graph -->
      <div class="content">
        <div class="left" id="graphdiv">
          <mint-ajax result="{{graphData}}" auto
            url="[[_createGraphURL(routeData.category, routeData.item)]]"></mint-ajax>
          <variable-graph id="cag"
            data="[[graphData]]" no-toolbar
            auto-load></variable-graph>
        </div>
        <div class="right" id="mapdiv">
          <!-- Top toolbar -->
          <div class="toolbar">
            <paper-button>MAP</paper-button>
          </div>
          <div class="outer">
            <mint-map variables="[[variables]]"></mint-map>
          </div>
          <div class="toolbar">
            <paper-button>&nbsp;</paper-button>
          </div>
        </div>
    </div>

  </template>

  <script>

    class MintResultsDetail extends Polymer.Element {
      static get is() { return 'mint-results-detail'; }

      static get properties() {
        return {
          server: String,
          userid: String,
          domain: String,
          graphData: {
            type: Object,
            observer: '_loadedGraph'
          },
          variables: {
            type: Array,
            notify: true,
            value: ['landuse', 'soil']
          },
          runid: String,
          route: Object,
          routeData: Object
        }
      }

      _loadedGraph(data) {
          /*console.log("Graph data loaded");
          console.log(data);*/
      }

      _createGraphURL(cat, item) {
        if(cat && item) {
          var url = "files/" + cat + "/" + item + ".json";
          return url;
        }
        return null;
      }
    }

    customElements.define(MintResultsDetail.is, MintResultsDetail);

  </script>

</dom-module>
