<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/mint-map/mint-map.html">
<link rel="import" href="mint-ajax.html">
<link rel="import" href="variable-graph.html">
<link rel="import" href="mint-common-styles.html">

<dom-module id="mint-data-list">
  <template>
    <style include="mint-common-styles">
      .searchbox {
        @apply(--layout-horizontal);
        width: 100%;
      }
      .searchbox paper-button {
        font-size: 14px;
      }
      .searchbox paper-input {
        width: 100%;
      }
    </style>

    <app-route
        route="[[route]]"
        pattern="/:standard_name"
        data="{{routeData}}"></app-route>

    <!-- Top toolbar -->
    <div class="toolbar">
      <paper-button>DATASETS: [[standard_name]]</paper-button>
    </div>
    <div class="outer">
      <loading-screen id="datalistloader"></loading-screen>
      <ul>
        <template is="dom-repeat" items="[[files_list]]">
          <li><a href="[[_getViewDataURL(item)]]">[[item.dataset.value]]</li>
        </template>
      </ul>
    </div>
    <!-- Bottom toolbar -->
    <div class="toolbar bottom">
      <paper-button>&nbsp;</paper-button>
    </div>

  </template>

  <script>

    class MintDataList extends Polymer.Element {
      static get is() { return 'mint-data-list'; }

      static get properties() {
        return {
          dataCatalog: Object,
          standard_name: String,
          data_list: Array,
          routeData: Object,
          route: Object,
          visible: Boolean
        };
      }

      static get observers() {
        return [
          '_routeDataChanged(routeData)'
        ];
      }

      _routeDataChanged(routeData) {
        if(routeData.standard_name) {
          this.set("standard_name", routeData.standard_name);
          this._searchData();
        }
      }

      _searchData() {
        var me = this;
        me.$.datalistloader.loading = true;
        this.dataCatalog.getVariableData(this.standard_name, function(list) {
          me.$.datalistloader.loading = false;
          me.set("files_list", list);
        });
      }

      _getViewDataURL(item) {
        var url = "data/view/"+this.standard_name+"/";
        var json = {ds:item.dataset.value, id:item.variable_id.value, md5:item.md5hash.value};
        url += btoa(JSON.stringify(json));
        return url;
      }
    }

    customElements.define(MintDataList.is, MintDataList);
  </script>
</dom-module>
